<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

     

    <title>Document</title>

</head>

<body>

    <p align="center"><b>Book A Call</b></p>

    <p align="center">Book a call slot and our representative will call you within 1hr of selected time</p>

    <form action="#" onsubmit="saveData(event)" >

        <label>Name</label><br>

        <input type="text" name="username" id="name"required><br>

        <label>Email</label><br>

        <input type="email" name="email" id="email" required><br>

        <label>Phone</label><br>

        <input type="number" name="phone" id="number" required><br>

        <label>Time for call</label><br>

        <input type="datetime-local" name="time" id="time" required><br>

        <button>Get A Call</button>

    </form>

<ul id='listOfUsers'> </ul>


<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>
    <script>
             

function saveData(event){
    event.preventDefault();
    
    const name = event.target.username.value;
    const email = event.target.email.value;
    const number = event.target.number.value;
    const time = event.target.time.value;

    const obj={
        name,
        email,
        number,
        time
    }
    //localStorage.setItem(obj.email,JSON.stringify(obj))
    //showNewUsersOnScreen(obj)
    axios.post('https://crudcrud.com/api/6878d1b0d1964963965fae43cdf6d1ca/appointmentData',obj)
    .then(response=>{
        showNewUsersOnScreen(response.data);
        console.log(response);
    })
    .catch((err)=>{
       console.log(err);
    })

}

  window.addEventListener("DOMContentLoaded", ()=>{
        
      axios.get('https://crudcrud.com/api/6878d1b0d1964963965fae43cdf6d1ca/appointmentData')
      .then((response)=>{
          console.log(response);
          for(var i=0;i<response.data.length;i++){
              showNewUsersOnScreen(response.data[i]);
          }
      })
      .catch((err)=>{
      console.log(err);
      })

      /*
      const localStorageObj= localStorage;
      const localStoragekeys=Object.keys(localStorageObj);

      for(let i=0;i<localStoragekeys.length;i++){
          const key = localStoragekeys[i];
          const userDetailsString= localStorageObj[key];
          const userDetailsObj=JSON.parse(userDetailsString);
          showNewUsersOnScreen(userDetailsObj)
      }*/
  })


function showNewUsersOnScreen(user){
    if(localStorage.getItem(user.email)!==null){
        removeUserFromScreen(user.email)
        }
    const parentNode= document.getElementById('listOfUsers');
    const childHTMl= `<li id =${user._id}> ${user.name}--${user.email}--${user.number}--${user.time}
        <button onclick=editUser('${user.name}','${user.email}','${user.number}','${user.time}','${user._id}')>Edit</button>
         <button onclick=deleteUser('${user._id}')>Delete</button></li>`
    parentNode.innerHTML= parentNode.innerHTML + childHTMl;
    console.log(parentNode.innerHTML);
}

function deleteUser(_id) {
    axios.delete(`https://crudcrud.com/api/6878d1b0d1964963965fae43cdf6d1ca/appointmentData/${_id}`)
        .then((res)=>{
            removeUserFromScreen(_id)
        })
        .catch((err)=>{
            console.log(err);
        })
}

function editUser(name,email,number,time,_id){
        document.getElementById("name").value = name;
        document.getElementById("email").value = email;
        document.getElementById("number").value = number;
        document.getElementById("time").value = time;
        deleteUser(_id);
}


function removeUserFromScreen(_id){
    const parentNode=document.getElementById('listOfUsers');
    const childToBeDeleted = document.getElementById(_id);
    if(childToBeDeleted){
       parentNode.removeChild(childToBeDeleted)
    }
}
    </script>

</body>

</html>