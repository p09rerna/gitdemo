<!DOCTYPE html> 
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Expense Tracker</title>
    </head>
    <body>
      <h1>Expense Tracker</h1>
      
    <form action="#" onsubmit="saveData(event)" >

        <label>Calculate Expense Amount: </label><br>
        <input type="number" name="amount" id="amount" placeholder="Enter the amount..."required><br>

        <label>Choose Description: </label><br>
        <input type="text" name="desc" id="desc" placeholder="Enter description..."required><br>

        <label for="category">Choose A Category: </label><br>
        <select name="category" id="category" required>
            <option value="None" selected>None</option>
            <option value="Education Fees">Education Fees</option>
            <option value="Movies">Movies</option>
            <option value="Food">Food</option>
            <option value="Travel">Travel</option>
            <option value="Fuel">Fuel</option>
            <option value="Others">Others</option>
          </select>

        <h4><button>Add Expense</button></h4>

    </form>

    <ul id='listOfUsers'> </ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>

    <script>
  async  function saveData(event){
      try{
    event.preventDefault();
    const amount = event.target.amount.value;
    const desc = event.target.desc.value;
    const category = event.target.category.value;

    const obj={
        amount,
        desc,
        category
    }
    const newData = await axios.post('https://crudcrud.com/api/448df21edc234a0b807c1dc631990592/expenseData',obj)
        showNewUsersOnScreen(newData.data);
        console.log(newData);
    }
    catch(err){
        console.log("Something went wrong",err);
    }
  }

let createdData;
  window.addEventListener("DOMContentLoaded",createdData=async () => {
    try{
    const getData= await axios.get('https://crudcrud.com/api/448df21edc234a0b807c1dc631990592/expenseData')
          console.log(getData);
          for(var i=0;i<getData.data.length;i++){
              showNewUsersOnScreen(getData.data[i]);
          }
        }
        catch(err){
            console.log("Something went wrong",err);
        }
      })
createdData();

async function deleteUser(_id) { 
  
  try{
    const deletedData= await axios.delete(`https://crudcrud.com/api/448df21edc234a0b807c1dc631990592/expenseData/${_id}`)
    removeUserFromScreen(_id)
  }
    catch(err){
        console.log("Something went wrong",err);
    }

}

function editUser(amount,desc,category,_id){
        document.getElementById("amount").value = amount;
        document.getElementById("desc").value = desc;
        document.getElementById("category").value = category;
        deleteUser(_id);
}

function removeUserFromScreen(_id){
    const parentNode=document.getElementById('listOfUsers');
    const childToBeDeleted = document.getElementById(_id);
    if(childToBeDeleted){
        parentNode.removeChild(childToBeDeleted);
    }
 }

function showNewUsersOnScreen(user){
    if(localStorage.getItem(user._id)!==null){
        removeUserFromScreen(_id)
        }
    const parentNode= document.getElementById('listOfUsers');
    const childHTMl= `<li id =${user._id}> ${user.amount} , ${user.desc} , ${user.category}
        <button onclick=editUser('${user.amount}','${user.desc}','${user.category}','${user._id}')>Edit Expense</button>
         <button onclick=deleteUser('${user._id}')>Delete Expense</button></li>`
    parentNode.innerHTML= parentNode.innerHTML + childHTMl;
    console.log(parentNode.innerHTML);
  }


    </script>
    </body>
</html>